/* Virtual Keyboard Styles
 * CSS Custom Properties for easy theming
 * No !important - Shadow DOM provides encapsulation
 */

/* =============================================================================
   CSS Custom Properties (Theme Variables)
   ============================================================================= */

:host {
  /* Colors */
  --vk-bg: linear-gradient(to top, #000, #333);
  --vk-key-bg: #525152;
  --vk-key-active-bg: #ddd;
  --vk-key-active-color: #333;
  --vk-key-color: #fff;
  --vk-action-key-bg: #212021;
  --vk-space-key-bg: #212421;
  --vk-shift-active-bg: #ddd;
  --vk-shift-active-color: #333;

  /* Overlay colors */
  --vk-overlay-bg: linear-gradient(to top, #000, #333);
  --vk-overlay-btn-bg: rgba(255, 255, 255, 0.05);
  --vk-overlay-btn-hover-bg: rgba(255, 255, 255, 0.3);

  /* URL bar colors */
  --vk-url-bar-bg: rgba(255, 255, 255, 0.8);

  /* Sizing */
  --vk-padding: 12px;
  --vk-key-padding: 0.28em;
  --vk-key-radius: 6px;
  --vk-key-font-size: 32px;
  --vk-action-font-size: 22px;

  /* Animation */
  --vk-transition-duration: 0.4s;
  --vk-transition-timing: ease;

  /* Z-index */
  --vk-z-index: 10000000;
  --vk-overlay-z-index: 10000001;

  /* Reset inherited properties that can leak through Shadow DOM */
  line-height: normal;
  text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
}

/* Universal reset within shadow DOM - block inherited styles from page */
:host *,
:host *::before,
:host *::after {
  box-sizing: border-box;
  line-height: normal;
}

/* =============================================================================
   Keyboard Container
   ============================================================================= */

#virtual-keyboard {
  --vk-offset-x: 0px;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  overflow: visible;
  margin-left: auto;
  margin-right: auto;
  transform: translateX(var(--vk-offset-x)) translateY(100%);
  opacity: 0;
  max-width: fit-content;
  width: 100%;
  box-sizing: border-box;
  z-index: var(--vk-z-index);
  user-select: none;
  transition:
    transform var(--vk-transition-duration) var(--vk-transition-timing),
    opacity var(--vk-transition-duration) var(--vk-transition-timing);
  font-family: "Segoe UI", Tahoma, sans-serif;
}

#virtual-keyboard.keyboard-open {
  transform: translateX(var(--vk-offset-x)) translateY(0);
  opacity: 1;
}

#virtual-keyboard.keyboard-closed {
  transform: translateX(var(--vk-offset-x)) translateY(100%);
  opacity: 0;
}

/* Inner wrapper for zoom scaling - separates scale from positioning */
.vk-scale-wrapper {
  --vk-zoom-width: 1;
  --vk-zoom-height: 1;
  position: relative;
  transform: scale(var(--vk-zoom-width), var(--vk-zoom-height));
  transform-origin: bottom center;
  padding: var(--vk-padding);
  background: var(--vk-bg);
  box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2);
}

/* =============================================================================
   Keyboard Rows
   ============================================================================= */

.vk-row {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin: 5px 0;
  width: 100%;
  max-width: 100%;
  line-height: normal;
  height: auto;
}

/* =============================================================================
   Keys - Base Styles
   ============================================================================= */

.vk-key {
  position: relative;
  padding: var(--vk-key-padding) 0.5em;
  margin: 0;
  border: none;
  border-radius: var(--vk-key-radius);
  background: var(--vk-key-bg);
  color: var(--vk-key-color);
  font-family: inherit;
  flex: 0 1 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--vk-key-font-size);
  line-height: 1.2;
  text-align: center;
  cursor: pointer;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 1px rgba(0, 0, 0, 1);
  transition:
    background 0.15s,
    color 0.15s,
    transform 0.1s;
  text-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  flex: 1;
  min-width: var(--vk-key-min-width, 0);
  height: auto;
  min-height: 0;
  max-height: none;
}

.vk-key:active,
.vk-key.active {
  background: var(--vk-key-active-bg);
  color: var(--vk-key-active-color);
}

.vk-key span {
  display: block;
  line-height: 1;
  height: auto;
  padding: 0;
  margin: 0;
}

/* =============================================================================
   Special Key Types
   ============================================================================= */

/* Action keys (Close, &123, Settings) */
.vk-key-action {
  background: var(--vk-action-key-bg);
  font-size: var(--vk-action-font-size);
}

/* Space key */
.vk-key-space {
  flex: 3;
  background: var(--vk-space-key-bg);
  /* Ensure spacebar has proper height even when it's the only key in the row */
  min-height: calc(1.2em + var(--vk-key-padding) * 2);
  /* Prevent browser from intercepting touch gestures during swipe */
  touch-action: none;
}

/* Wider space key (when language button is hidden) */
.vk-key-space-wide {
  flex: 4;
}

/* Shift key */
.vk-key-shift {
  background: var(--vk-action-key-bg);
  flex: 1.2;
}

.shift-active .vk-key-shift {
  background: var(--vk-shift-active-bg);
  color: var(--vk-shift-active-color);
}

/* Backspace key */
.vk-key-backspace {
  background: var(--vk-key-bg);
  flex: 1.5;
}

.vk-key-backspace-sm {
  background: var(--vk-key-bg);
  flex: 1;
}

/* Enter key */
.vk-key-enter {
  background: var(--vk-key-bg);
  flex: 1.5;
}

/* Spacer (empty cell) */
.vk-spacer {
  width: 1px;
  visibility: hidden;
  padding: 0;
  margin: 0;
  flex: 0 0 1px;
}

/* Language button (menu button, not a clickable key) */
.vk-lang-btn {
  position: relative;
  padding: var(--vk-key-padding) 0.5em;
  margin: 0;
  border: none;
  border-radius: var(--vk-key-radius);
  background: var(--vk-action-key-bg);
  color: var(--vk-key-color);
  font-family: inherit;
  font-size: var(--vk-action-font-size);
  text-align: center;
  cursor: pointer;
  box-shadow:
    inset 0 1px 0 rgba(255, 255, 255, 0.4),
    inset 0 -1px 1px rgba(0, 0, 0, 1);
  transition:
    background 0.15s,
    color 0.15s,
    transform 0.1s;
  text-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
  flex: 1;
  min-width: var(--vk-key-min-width, 0);
}

.vk-lang-btn:active {
  background: var(--vk-key-active-bg);
  color: var(--vk-key-active-color);
}

.vk-lang-btn span {
  display: block;
  line-height: 1;
}

/* URL button text adjustment */
#vk-url-btn span {
  margin-left: -10px;
}

/* =============================================================================
   Icons (Unicode characters)
   ============================================================================= */

.vk-icon {
  display: block;
  font-size: 24px;
  line-height: 1;
}

.vk-icon-shift::before {
  content: "⇧";
}

.vk-icon-backspace::before {
  content: "⌫";
}

.vk-icon-enter::before {
  content: "↵";
}

.vk-icon-close::before {
  content: "✕";
}

.vk-icon-settings::before {
  content: "⚙";
}

/* =============================================================================
   Shift Mode - Uppercase Display
   ============================================================================= */

.shift-active .vk-key-case {
  text-transform: uppercase;
}

/* Keys with explicit shift display (Korean, etc.) */
.vk-key-case span {
  /* Content updated via JavaScript */
}

/* =============================================================================
   Email Input Keys
   Note: Visibility is controlled by JavaScript (setEmailKeysVisibility)
   These are just initial states before JS runs
   ============================================================================= */

.vk-email-key {
  display: none;
}

.vk-hide-email-key {
  display: inline-flex;
}

/* =============================================================================
   Number Bar
   ============================================================================= */

#vk-number-bar {
  display: flex;
  gap: 6px;
  margin-bottom: 5px;
}

#vk-number-bar .vk-key {
  padding: var(--vk-key-padding) 0.5em;
}

/* Hide number bar on small screens */
@media (max-height: 600px) {
  #vk-number-bar {
    display: none;
  }
}

/* =============================================================================
   Number Input Keyboard (for number/tel inputs)
   ============================================================================= */

#vk-number-bar-input {
  max-width: 400px;
  margin: 0 auto;
}

/* =============================================================================
   Numbers/Symbols Keyboard
   ============================================================================= */

#vk-main-numbers .vk-key {
  padding: var(--vk-key-padding);
}

/* =============================================================================
   Overlays (Settings menu, accent menus)
   ============================================================================= */

.vk-overlay {
  position: absolute;
  z-index: var(--vk-overlay-z-index);
  padding: 5px;
  border-radius: 5px;
  background: var(--vk-overlay-bg);
  box-shadow: 0 0 10px #000;
  transition:
    opacity 0.4s,
    margin 0.2s;
}

.vk-overlay[data-state="closed"] {
  opacity: 0;
  margin-bottom: -5px;
  pointer-events: none;
}

.vk-overlay[data-state="open"] {
  opacity: 1;
  margin-bottom: 0;
}

.vk-overlay-keys {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 6px;
}

.vk-overlay-btn {
  padding: 20px;
  border-radius: 5px;
  background: var(--vk-overlay-btn-bg);
  color: #fff;
  font-size: 14px;
  font-weight: bold;
  text-shadow: 0 0 3px #000;
  cursor: pointer;
  transition: background 0.2s;
}

.vk-overlay-btn:hover,
.vk-overlay-btn[data-mouse-over="true"] {
  background: var(--vk-overlay-btn-hover-bg);
}

/* =============================================================================
   URL Bar
   ============================================================================= */

#vk-url-bar {
  position: fixed;
  top: -100px;
  left: 50%;
  transform: translateX(-50%);
  width: 600px;
  padding: 5px;
  background: var(--vk-url-bar-bg);
  border-radius: 0 0 3px 3px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  z-index: 999999;
  transition: top 0.3s;
}

#vk-url-bar[data-open="true"] {
  top: -70px;
}

#vk-url-bar-textbox {
  width: calc(100% - 20px);
  padding: 5px;
  font-size: 30px;
  border: 1px solid #ccc;
  border-radius: 3px;
}

#vk-url-bar input[type="submit"] {
  display: none;
}

/* =============================================================================
   Scroll Extend Element
   ============================================================================= */

#vk-scroll-extend {
  height: 500px;
}

/* =============================================================================
   Drag Handle for Repositioning
   ============================================================================= */

.vk-drag-handle {
  position: absolute;
  top: -28px;
  left: 50%;
  transform: translateX(-50%);
  padding: 8px 16px;
  cursor: grab;
  user-select: none;
  touch-action: none;
}

.vk-drag-handle::before {
  content: "";
  display: block;
  width: 40px;
  height: 4px;
  background: rgba(128, 128, 128, 0.8);
  border-radius: 2px;
  box-shadow:
    0 8px 0 rgba(128, 128, 128, 0.8),
    0 0 2px rgba(255, 255, 255, 0.8),
    0 8px 2px rgba(255, 255, 255, 0.8),
    0 0 4px rgba(0, 0, 0, 0.6),
    0 8px 4px rgba(0, 0, 0, 0.6);
  transition:
    background 0.2s,
    box-shadow 0.2s;
}

.vk-drag-handle:hover::before {
  background: rgba(100, 100, 100, 0.9);
  box-shadow:
    0 8px 0 rgba(100, 100, 100, 0.9),
    0 0 2px rgba(255, 255, 255, 0.9),
    0 8px 2px rgba(255, 255, 255, 0.9),
    0 0 5px rgba(0, 0, 0, 0.7),
    0 8px 5px rgba(0, 0, 0, 0.7);
}

.vk-drag-handle:active,
#virtual-keyboard.vk-dragging .vk-drag-handle {
  cursor: grabbing;
}

.vk-drag-handle:active::before,
#virtual-keyboard.vk-dragging .vk-drag-handle::before {
  background: rgba(80, 80, 80, 1);
  box-shadow:
    0 8px 0 rgba(80, 80, 80, 1),
    0 0 3px rgba(255, 255, 255, 1),
    0 8px 3px rgba(255, 255, 255, 1),
    0 0 6px rgba(0, 0, 0, 0.8),
    0 8px 6px rgba(0, 0, 0, 0.8);
}

#virtual-keyboard.vk-dragging {
  transition: none;
}

/* =============================================================================
   Responsive Zoom (based on viewport size)
   Uses min() to pick the smaller scale when both width and height are constrained
   - Height: scales from 100% at 950px down to 35% minimum
   - Width: scales from 100% at 850px down to 45% minimum
   ============================================================================= */

.vk-scale-wrapper {
  zoom: min(
    clamp(0.35, calc(100vh / 950), 1),
    clamp(0.45, calc(100vw / 850), 1)
  );
}

/* =============================================================================
   Touch-friendly Form Elements (for options page)
   ============================================================================= */

.touchEnable input[type="checkbox"],
.touchEnable input[type="radio"] {
  appearance: none;
  width: 26px;
  height: 26px;
  border: 1px solid #a0a0a0;
  border-radius: 3px;
  background: linear-gradient(#fafafa, gainsboro);
  box-shadow:
    inset 0 1px 2px white,
    0 1px 2px rgba(0, 0, 0, 0.2);
  vertical-align: middle;
  cursor: pointer;
}

.touchEnable input[type="radio"] {
  border-radius: 50%;
}

.touchEnable input[type="checkbox"]:checked::before {
  content: "✓";
  display: block;
  text-align: center;
  font-size: 18px;
  color: gray;
  line-height: 24px;
}

.touchEnable input[type="radio"]:checked::before {
  content: "";
  display: block;
  width: 14px;
  height: 14px;
  margin: 5px;
  background: gray;
  border-radius: 50%;
}

.touchEnable button {
  padding: 15px 40px;
  border: 1px solid #a0a0a0;
  border-radius: 3px;
  background: linear-gradient(#fafafa, gainsboro);
  box-shadow:
    inset 0 1px 2px white,
    0 1px 2px rgba(0, 0, 0, 0.2);
  font-size: 13px;
  cursor: pointer;
  user-select: none;
}

.touchEnable input[type="text"],
.touchEnable input[type="search"],
.touchEnable input[type="password"],
.touchEnable textarea {
  padding: 7px;
  border: 1px solid #a0a0a0;
  border-radius: 3px;
  font-size: 20px;
  box-shadow:
    inset 0 2px 2px rgba(0, 0, 0, 0.1),
    0 1px 0 white;
}
