<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Virtual Keyboard - Dynamic Input Test</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
        line-height: 1.6;
      }
      h1 {
        color: #333;
      }
      h2 {
        color: #666;
        margin-top: 30px;
      }
      .test-section {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      button {
        background: #4285f4;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #3367d6;
      }
      input,
      textarea {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin: 10px 0;
        width: 300px;
        display: block;
      }
      textarea {
        height: 80px;
      }
      .dynamic-container {
        min-height: 100px;
        border: 2px dashed #ccc;
        padding: 20px;
        margin: 10px 0;
      }
      .status {
        background: #e8f5e9;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .status.fail {
        background: #ffebee;
      }
      [contenteditable] {
        border: 1px solid #ddd;
        padding: 10px;
        min-height: 50px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>Virtual Keyboard - Dynamic Input Test</h1>
    <p>
      This page tests that the virtual keyboard correctly detects dynamically
      added input elements using MutationObserver.
    </p>

    <h2>1. Static Inputs (should work immediately)</h2>
    <div class="test-section">
      <input
        type="text"
        placeholder="Static text input - click to test keyboard"
      />
      <textarea
        placeholder="Static textarea - click to test keyboard"
      ></textarea>
      <div contenteditable="true">
        Static contenteditable - click to test keyboard
      </div>
    </div>

    <h2>2. Dynamically Added Inputs</h2>
    <div class="test-section">
      <p>
        Click buttons below to add inputs dynamically. The keyboard should
        activate when you click on them.
      </p>
      <button onclick="addTextInput()">Add Text Input</button>
      <button onclick="addTextarea()">Add Textarea</button>
      <button onclick="addContentEditable()">Add ContentEditable</button>
      <button onclick="addPasswordInput()">Add Password Input</button>
      <button onclick="addEmailInput()">Add Email Input</button>
      <button onclick="clearContainer()">Clear All</button>

      <div id="dynamic-container" class="dynamic-container">
        <em>Dynamic inputs will appear here...</em>
      </div>
    </div>

    <h2>3. Delayed Input Addition</h2>
    <div class="test-section">
      <p>Tests inputs added after a delay (simulating AJAX/fetch responses).</p>
      <button onclick="addDelayedInput(500)">Add Input after 500ms</button>
      <button onclick="addDelayedInput(2000)">Add Input after 2s</button>
      <button onclick="addDelayedInput(5000)">Add Input after 5s</button>

      <div id="delayed-container" class="dynamic-container">
        <em>Delayed inputs will appear here...</em>
      </div>
    </div>

    <h2>4. Nested Container Test</h2>
    <div class="test-section">
      <p>Tests inputs added inside nested DOM structures.</p>
      <button onclick="addNestedInputs()">
        Add Nested Structure with Inputs
      </button>

      <div id="nested-container" class="dynamic-container">
        <em>Nested structures will appear here...</em>
      </div>
    </div>

    <h2>5. Iframe Test</h2>
    <div class="test-section">
      <p>Tests keyboard and floating button behavior inside iframes.</p>
      <p>
        <strong>Instructions:</strong> Each iframe should have its own floating
        keyboard button. Clicking the button or focusing an input should open
        the keyboard, and the button should disappear in ALL frames.
      </p>
      <p>
        <strong>Note:</strong> This test requires serving the files from a web
        server (e.g., <code>npx serve .</code> or
        <code>python -m http.server</code>). File:// URLs won't work properly
        for iframe content script injection.
      </p>

      <h4>Same-origin iframe 1:</h4>
      <iframe
        id="test-iframe-1"
        src="test-iframe-content.html"
        style="
          width: 100%;
          height: 220px;
          border: 2px solid #4285f4;
          border-radius: 4px;
        "
      ></iframe>

      <h4 style="margin-top: 20px">Same-origin iframe 2:</h4>
      <iframe
        id="test-iframe-2"
        src="test-iframe-content.html"
        style="
          width: 100%;
          height: 220px;
          border: 2px solid #34a853;
          border-radius: 4px;
        "
      ></iframe>
    </div>

    <h2>6. Scroll Behavior Test</h2>
    <div class="test-section">
      <p>Tests that the keyboard scrolls the page to keep inputs visible.</p>
      <p>
        <strong>Instructions:</strong> Click the input below. When the keyboard
        opens, the page should automatically scroll so the input remains visible
        above the keyboard.
      </p>
    </div>

    <!-- Spacer to push content down -->
    <div
      style="
        height: 400px;
        background: linear-gradient(to bottom, #f5f5f5, #e0e0e0);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
      "
    >
      (Spacer area - scroll down to find the test input)
    </div>

    <div class="test-section" style="margin-bottom: 20px">
      <h3>Bottom-of-page Input</h3>
      <p>
        This input is near the bottom of the page. When the keyboard opens,
        intelligent scroll should move it into view.
      </p>
      <input
        type="text"
        placeholder="Click me - keyboard should scroll page to keep me visible"
        style="width: 100%; max-width: 500px"
      />
      <textarea
        placeholder="Or try this textarea near the bottom"
        style="width: 100%; max-width: 500px"
      ></textarea>
    </div>

    <script>
      let inputCount = 0;

      function addTextInput() {
        const container = document.getElementById("dynamic-container");
        clearPlaceholder(container);
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Dynamic text input #${++inputCount}`;
        container.appendChild(input);
      }

      function addTextarea() {
        const container = document.getElementById("dynamic-container");
        clearPlaceholder(container);
        const textarea = document.createElement("textarea");
        textarea.placeholder = `Dynamic textarea #${++inputCount}`;
        container.appendChild(textarea);
      }

      function addContentEditable() {
        const container = document.getElementById("dynamic-container");
        clearPlaceholder(container);
        const div = document.createElement("div");
        div.contentEditable = "true";
        div.textContent = `Dynamic contenteditable #${++inputCount}`;
        div.style.cssText =
          "border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;";
        container.appendChild(div);
      }

      function addPasswordInput() {
        const container = document.getElementById("dynamic-container");
        clearPlaceholder(container);
        const input = document.createElement("input");
        input.type = "password";
        input.placeholder = `Dynamic password input #${++inputCount}`;
        container.appendChild(input);
      }

      function addEmailInput() {
        const container = document.getElementById("dynamic-container");
        clearPlaceholder(container);
        const input = document.createElement("input");
        input.type = "email";
        input.placeholder = `Dynamic email input #${++inputCount}`;
        container.appendChild(input);
      }

      function clearContainer() {
        const container = document.getElementById("dynamic-container");
        container.innerHTML = "<em>Dynamic inputs will appear here...</em>";
      }

      function addDelayedInput(delay) {
        const container = document.getElementById("delayed-container");
        clearPlaceholder(container);

        const status = document.createElement("div");
        status.className = "status";
        status.textContent = `Adding input in ${delay}ms...`;
        container.appendChild(status);

        setTimeout(() => {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = `Input added after ${delay}ms delay (#${++inputCount})`;
          container.appendChild(input);
          status.textContent = `Input added! Click on it to test keyboard.`;
        }, delay);
      }

      function addNestedInputs() {
        const container = document.getElementById("nested-container");
        clearPlaceholder(container);

        const wrapper = document.createElement("div");
        wrapper.innerHTML = `
                <div style="border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 4px;">
                    <h4 style="margin: 0 0 10px 0;">Nested Form #${++inputCount}</h4>
                    <div>
                        <label>Name:</label>
                        <input type="text" placeholder="Nested input - name">
                    </div>
                    <div style="margin-top: 10px;">
                        <label>Email:</label>
                        <input type="email" placeholder="Nested input - email">
                    </div>
                    <div style="margin-top: 10px;">
                        <label>Message:</label>
                        <textarea placeholder="Nested textarea"></textarea>
                    </div>
                </div>
            `;
        container.appendChild(wrapper);
      }

      function clearPlaceholder(container) {
        const placeholder = container.querySelector("em");
        if (placeholder) placeholder.remove();
      }
    </script>
  </body>
</html>
